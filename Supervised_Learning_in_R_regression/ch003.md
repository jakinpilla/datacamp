Advanced\_R(chap\_2)
================
jakinpilla
2019-12-19

  - [Logistic Regression](#logistic-regression)

``` r
library(tidyverse)
library(broom)
library(gridExtra)
library(psych)
library(WVPlots)
```

### Logistic Regression

#### Fit a model of sparrow survival probability

sparrow survival probability against severe winter storm

  - total\_length: length of the bird from tip of beak to tip of tail
    (mm)
  - weight: in grams
  - humerus : length of humerus (“upper arm bone” that connects the wing
    to the body) (inches) psedo r-square : deviance explained…

<!-- end list -->

``` r
sparrow <- readRDS('./data/sparrow.rds')
summary(sparrow)
```

    ##       status       age             total_length      wingspan    
    ##  Perished:36   Length:87          Min.   :153.0   Min.   :236.0  
    ##  Survived:51   Class :character   1st Qu.:158.0   1st Qu.:245.0  
    ##                Mode  :character   Median :160.0   Median :247.0  
    ##                                   Mean   :160.4   Mean   :247.5  
    ##                                   3rd Qu.:162.5   3rd Qu.:251.0  
    ##                                   Max.   :167.0   Max.   :256.0  
    ##      weight       beak_head        humerus           femur       
    ##  Min.   :23.2   Min.   :29.80   Min.   :0.6600   Min.   :0.6500  
    ##  1st Qu.:24.7   1st Qu.:31.40   1st Qu.:0.7250   1st Qu.:0.7000  
    ##  Median :25.8   Median :31.70   Median :0.7400   Median :0.7100  
    ##  Mean   :25.8   Mean   :31.64   Mean   :0.7353   Mean   :0.7134  
    ##  3rd Qu.:26.7   3rd Qu.:32.10   3rd Qu.:0.7500   3rd Qu.:0.7300  
    ##  Max.   :31.0   Max.   :33.00   Max.   :0.7800   Max.   :0.7600  
    ##     legbone          skull           sternum      
    ##  Min.   :1.010   Min.   :0.5600   Min.   :0.7700  
    ##  1st Qu.:1.110   1st Qu.:0.5900   1st Qu.:0.8300  
    ##  Median :1.130   Median :0.6000   Median :0.8500  
    ##  Mean   :1.131   Mean   :0.6032   Mean   :0.8511  
    ##  3rd Qu.:1.160   3rd Qu.:0.6100   3rd Qu.:0.8800  
    ##  Max.   :1.230   Max.   :0.6400   Max.   :0.9300

EDA

``` r
sparrow$survived <- ifelse(sparrow$status == 'Survived', 'Survived', 'Dead')
sparrow %>% str()
```

    ## 'data.frame':    87 obs. of  12 variables:
    ##  $ status      : Factor w/ 2 levels "Perished","Survived": 2 2 2 2 2 2 2 2 2 2 ...
    ##  $ age         : chr  "adult" "adult" "adult" "adult" ...
    ##  $ total_length: int  154 160 155 154 156 161 157 159 158 158 ...
    ##  $ wingspan    : int  241 252 243 245 247 253 251 247 247 252 ...
    ##  $ weight      : num  24.5 26.9 26.9 24.3 24.1 26.5 24.6 24.2 23.6 26.2 ...
    ##  $ beak_head   : num  31.2 30.8 30.6 31.7 31.5 31.8 31.1 31.4 29.8 32 ...
    ##  $ humerus     : num  0.69 0.74 0.73 0.74 0.71 0.78 0.74 0.73 0.7 0.75 ...
    ##  $ femur       : num  0.67 0.71 0.7 0.69 0.71 0.74 0.74 0.72 0.67 0.74 ...
    ##  $ legbone     : num  1.02 1.18 1.15 1.15 1.13 1.14 1.15 1.13 1.08 1.15 ...
    ##  $ skull       : num  0.59 0.6 0.6 0.58 0.57 0.61 0.61 0.61 0.6 0.61 ...
    ##  $ sternum     : num  0.83 0.84 0.85 0.84 0.82 0.89 0.86 0.79 0.82 0.86 ...
    ##  $ survived    : chr  "Survived" "Survived" "Survived" "Survived" ...

``` r
# sparrow %>% str()
```

``` r
sparrow %>% 
  ggplot(aes(survived, total_length, col = survived)) + 
  geom_boxplot(alpha = .5) +
  geom_jitter() + 
  theme(legend.position = "none") +
  scale_color_brewer(palette = 'Set1') -> p1

sparrow %>% 
  ggplot(aes(survived, weight, col = survived)) + 
  geom_boxplot(alpha = .5) +
  geom_jitter() + 
  theme(legend.position = "none") +
  scale_color_brewer(palette = 'Set1') -> p2

sparrow %>% 
  ggplot(aes(humerus, fill = survived)) + 
  geom_density(alpha = .5) +
  # theme(legend.position = "none") +
  scale_fill_brewer(palette = 'Set1') -> p3

sparrow$survived %>% table() %>% 
  as.data.frame() %>%
  rename(status = '.') -> data

data %>%
  ggplot(aes(status, Freq, fill = status)) + geom_bar(stat = 'identity') +
  theme(legend.position = "none") +
  scale_fill_brewer(palette = 'Set1') -> p4

grid.arrange(p1, p2, p3, p4, ncol = 2)
```

![](ch003_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

show pairs graph…

``` r
sparrow %>%
  select(survived, total_length, weight, humerus) -> sparrow_1

pairs.panels(sparrow_1)
```

![](ch003_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

Create the survived column

``` r
sparrow$survived <- ifelse(sparrow$status == 'Survived', T, F)
```

Create the formula

``` r
(fmla <- survived ~ total_length + weight + humerus)
```

    ## survived ~ total_length + weight + humerus

Fit the logistic regression model

``` r
sparrow_model <- glm(fmla, data = sparrow, family = binomial)
```

Call summary

``` r
summary(sparrow_model)
```

    ## 
    ## Call:
    ## glm(formula = fmla, family = binomial, data = sparrow)
    ## 
    ## Deviance Residuals: 
    ##     Min       1Q   Median       3Q      Max  
    ## -2.1117  -0.6026   0.2871   0.6577   1.7082  
    ## 
    ## Coefficients:
    ##              Estimate Std. Error z value Pr(>|z|)    
    ## (Intercept)   46.8813    16.9631   2.764 0.005715 ** 
    ## total_length  -0.5435     0.1409  -3.858 0.000115 ***
    ## weight        -0.5689     0.2771  -2.053 0.040060 *  
    ## humerus       75.4610    19.1586   3.939 8.19e-05 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## (Dispersion parameter for binomial family taken to be 1)
    ## 
    ##     Null deviance: 118.008  on 86  degrees of freedom
    ## Residual deviance:  75.094  on 83  degrees of freedom
    ## AIC: 83.094
    ## 
    ## Number of Fisher Scoring iterations: 5

Call glance

``` r
(perf <- glance(sparrow_model))
```

    ## # A tibble: 1 x 7
    ##   null.deviance df.null logLik   AIC   BIC deviance df.residual
    ##           <dbl>   <int>  <dbl> <dbl> <dbl>    <dbl>       <int>
    ## 1          118.      86  -37.5  83.1  93.0     75.1          83

Calculate pseudo-R-squared

``` r
(pseudoR2 <- 1 - perf$deviance / perf$null.deviance)
```

    ## [1] 0.3636526

Make predictions

``` r
sparrow$pred <- predict(sparrow_model, type = 'response')
```

Look at gain curve

``` r
GainCurvePlot(sparrow, 'pred', 'survived', "sparrow survival model")
```

![](ch003_files/figure-gfm/unnamed-chunk-13-1.png)<!-- -->
